# version: '3.8'

# services:
#   # Service PHP-FPM
#   php:
#     build:
#       context: /home/dgi/www
#       dockerfile: docker/php/Dockerfile
#     container_name: symfony_php
#     restart: unless-stopped
#     working_dir: /var/www/html
#     volumes:
#       - /home/dgi/www/gif:/var/www/html:cached
#       - /home/dgi/www/var/log:/var/www/html/var/log
#     environment:
#       - APP_DEBUG=0
#       - APP_ENV=prod
#       - APP_SECRET=your_app_secret
#       - DATABASE_URL=mysql://symfony_user:symfony_pass@mysql:3306/symfony_db
#     networks:
#       - symfony_network
#     depends_on:
#       - mysql

#   # Service Nginx
#   nginx:
#     image: nginx:alpine
#     container_name: symfony_nginx
#     restart: unless-stopped
#     ports:
#       - "192.168.123.111:80:80"
#       - "192.168.123.111:443:443"
#     volumes:
#       - /home/dgi/www/gif:/var/www/html:ro
#       - /home/dgi/www/docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
#       - /home/dgi/www/var/log/nginx:/var/log/nginx
#       - /home/dgi/www/ssl:/etc/nginx/ssl
#     networks:
#       - symfony_network
#     depends_on:
#       - php

#   # Service MySQL
#   mysql:
#     image: mysql:8.0
#     container_name: symfony_mysql
#     restart: unless-stopped
#     environment:
#       MYSQL_ROOT_PASSWORD: rootpassword
#       MYSQL_DATABASE: symfony_db
#       MYSQL_USER: symfony_user
#       MYSQL_PASSWORD: symfony_pass
#     volumes:
#       - mysql_data:/var/lib/mysql
#       - /home/dgi/www/docker/mysql/conf.d:/etc/mysql/conf.d
#     ports:
#       - "3306:3306"
#     networks:
#       - symfony_network
#     command: --default-authentication-plugin=mysql_native_password

#   # Service phpMyAdmin (optionnel)
#   phpmyadmin:
#     image: phpmyadmin/phpmyadmin
#     container_name: symfony_phpmyadmin
#     restart: unless-stopped
#     depends_on:
#       - mysql
#     ports:
#       - "8080:80"
#     environment:
#       PMA_HOST: mysql
#       MYSQL_ROOT_PASSWORD: rootpassword
#     networks:
#       - symfony_network

#   # Service Worker (optionnel pour les tâches asynchrones)
#   # worker:
#   #   build:
#   #     context: /home/dgi/www
#   #     dockerfile: docker/php/Dockerfile
#   #   container_name: symfony_worker
#   #   command: php bin/console messenger:consume async -vv
#   #   restart: unless-stopped
#   #   volumes:
#   #     - /home/dgi/www:/var/www/html
#   #   networks:
#   #     - symfony_network
#   #   depends_on:
#   #     - php
#   #     - mysql

#   # Service MailHog (optionnel pour le développement)
#   # mailhog:
#   #   image: mailhog/mailhog
#   #   container_name: symfony_mailhog
#   #   ports:
#   #     - "1025:1025" # SMTP
#   #     - "8025:8025" # Web UI
#   #   networks:
#   #     - symfony_network

# # Définition des volumes et réseaux
# volumes:
#   mysql_data:
#     driver: local

# networks:
#   symfony_network:
#     driver: bridge














# version: '3.8'

# services:

#   php:
#     build:
#       context: ./   # ton code est ici sur Windows
#       dockerfile: docker/php/Dockerfile
#     container_name: symfony_php
#     restart: unless-stopped
#     working_dir: /var/www/html
#     volumes:
#       - ./gif:/var/www/html:cached
#       - ./var/log:/var/www/html/var/log
#     environment:
#       - APP_DEBUG=0
#       - APP_ENV=prod
#       - APP_SECRET=your_app_secret
#       - DATABASE_URL=mysql://symfony_user:symfony_pass@mysql:3306/symfony_db
#     networks:
#       - symfony_network
#     depends_on:
#       - mysql

#   nginx:
#     image: nginx:alpine
#     container_name: symfony_nginx
#     restart: unless-stopped
#     ports:
#       - "80:80"
#       - "443:443"
#     volumes:
#       - ./gif:/var/www/html:ro
#       - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
#       - ./var/log/nginx:/var/log/nginx
#       - ./ssl:/etc/nginx/ssl
#     networks:
#       - symfony_network
#     depends_on:
#       - php

#   mysql:
#     image: mysql:8.0
#     container_name: symfony_mysql
#     restart: unless-stopped
#     environment:
#       MYSQL_ROOT_PASSWORD: rootpassword
#       MYSQL_DATABASE: symfony_db
#       MYSQL_USER: symfony_user
#       MYSQL_PASSWORD: symfony_pass
#     volumes:
#       - mysql_data:/var/lib/mysql
#       - ./docker/mysql/conf.d:/etc/mysql/conf.d
#     ports:
#       - "3306:3306"
#     networks:
#       - symfony_network
#     command: --default-authentication-plugin=mysql_native_password

#   phpmyadmin:
#     image: phpmyadmin/phpmyadmin
#     container_name: symfony_phpmyadmin
#     restart: unless-stopped
#     depends_on:
#       - mysql
#     ports:
#       - "8080:80"
#     environment:
#       PMA_HOST: mysql
#       MYSQL_ROOT_PASSWORD: rootpassword
#     networks:
#       - symfony_network

# volumes:
#   mysql_data:

# networks:
#   symfony_network:
#     driver: bridge







version: '3.8'

services:

  php:
    build:
      context: ./
      dockerfile: docker/php/Dockerfile
    container_name: symfony_php
    restart: unless-stopped
    working_dir: /var/www/html
    volumes:
      - ./:/var/www/html:cached
      - ./var/log:/var/www/html/var/log
    environment:
      - APP_DEBUG=0
      - APP_ENV=prod
      - APP_SECRET=your_app_secret
      - DATABASE_URL=mysql://symfony_user:symfony_pass@mysql:3306/symfony_db
    networks:
      - symfony_network
    depends_on:
      - mysql

  nginx:
    image: nginx:alpine
    container_name: symfony_nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./:/var/www/html:ro
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ./var/log/nginx:/var/log/nginx
      - ./ssl:/etc/nginx/ssl
    networks:
      - symfony_network
    depends_on:
      - php

  mysql:
    image: mysql:8.0
    container_name: symfony_mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: symfony_db
      MYSQL_USER: symfony_user
      MYSQL_PASSWORD: symfony_pass
    volumes:
      - mysql_data:/var/lib/mysql
      - ./docker/mysql/conf.d:/etc/mysql/conf.d
    ports:
      - "3306:3306"
    networks:
      - symfony_network
    command: --default-authentication-plugin=mysql_native_password

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: symfony_phpmyadmin
    restart: unless-stopped
    depends_on:
      - mysql
    ports:
      - "8080:80"
    environment:
      PMA_HOST: mysql
      MYSQL_ROOT_PASSWORD: rootpassword
    networks:
      - symfony_network

volumes:
  mysql_data:

networks:
  symfony_network:
    driver: bridge
